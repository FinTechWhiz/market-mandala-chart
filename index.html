<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Market Mandala Chart</title>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
    }

    #controls {
      padding: 10px;
      background-color: #222;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #tv_chart_container {
      height: 80vh;
      width: 100%;
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

  <div id="controls">
    <div>
      <label for="companySelect">Company:</label>
      <select id="companySelect">
        <option value="NABIL">NABIL</option>
        <option value="NRIC">NRIC</option>
        <option value="NTC">NTC</option>
      </select>
    </div>
    <button id="toggleTheme">Toggle Dark Mode</button>
  </div>

  <div id="tv_chart_container"></div>

  <script>
    let chart, series;
    let darkMode = false;

    const demoData = {
      NABIL: generateData(100, 140),
      NRIC: generateData(600, 700),
      NTC: generateData(900, 1000)
    };

    function generateData(min, max) {
      const now = Math.floor(Date.now() / 1000);
      const data = [];
      for (let i = 0; i < 50; i++) {
        const t = now - (50 - i) * 86400;
        const o = random(min, max);
        const c = o + random(-10, 10);
        const h = Math.max(o, c) + random(0, 10);
        const l = Math.min(o, c) - random(0, 10);
        const v = random(1000, 10000);
        data.push({ time: t, open: o, high: h, low: l, close: c, volume: v });
      }
      return data;
    }

    function random(min, max) {
      return Math.round(min + Math.random() * (max - min));
    }

    function drawChart(symbol = 'NABIL') {
      const bg = darkMode ? '#1e1e1e' : '#ffffff';
      const fg = darkMode ? '#ffffff' : '#000000';

      document.getElementById('tv_chart_container').innerHTML = '';
      chart = LightweightCharts.createChart(document.getElementById('tv_chart_container'), {
        layout: {
          backgroundColor: bg,
          textColor: fg
        },
        width: window.innerWidth,
        height: window.innerHeight,
        rightPriceScale: {
          scaleMargins: {
            top: 0.1,
            bottom: 0.25
          }
        },
        timeScale: {
          timeVisible: true
        }
      });

      series = chart.addCandlestickSeries();
      const prices = demoData[symbol].map(d => ({
        time: d.time, open: d.open, high: d.high, low: d.low, close: d.close
      }));
      series.setData(prices);
    }

    document.getElementById('companySelect').addEventListener('change', (e) => {
      drawChart(e.target.value);
    });

    document.getElementById('toggleTheme').addEventListener('click', () => {
      darkMode = !darkMode;
      drawChart(document.getElementById('companySelect').value);
    });

    drawChart('NABIL'); // Initial chart render
  </script>
</body>
</html>
