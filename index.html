<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Market Mandala - NEPSE Chart</title>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body { margin: 0; font-family: Arial; }
    #tv_chart_container { width: 100vw; height: 100vh; }
    #controls, .logo {
      position: absolute;
      top: 10px;
      background: white;
      padding: 10px;
      border-radius: 8px;
      z-index: 10;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .logo { left: 10px; font-weight: bold; }
    #controls {
      right: 10px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    input, select, button {
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="logo">Market Mandala</div>
  <div id="controls">
    <input type="text" placeholder="Search (demo)">
    <select id="chartType">
      <option value="candlestick">Candlestick</option>
      <option value="line">Line</option>
    </select>
    <button id="toggleTheme">Dark Mode</button>
  </div>
  <div id="tv_chart_container"></div>

  <script>
    let dark = false;
    let chart, series, volumeSeries;

    function drawChart(type = 'candlestick') {
      const bg = dark ? '#1e1e1e' : '#ffffff';
      const fg = dark ? '#ffffff' : '#000000';

      document.getElementById('tv_chart_container').innerHTML = '';
      chart = LightweightCharts.createChart(document.getElementById('tv_chart_container'), {
        layout: { backgroundColor: bg, textColor: fg },
        width: window.innerWidth,
        height: window.innerHeight,
        timeScale: { timeVisible: true },
      });

      if (type === 'candlestick') {
        series = chart.addCandlestickSeries();
      } else {
        series = chart.addLineSeries();
      }

      volumeSeries = chart.addHistogramSeries({
        priceFormat: { type: 'volume' },
        priceScaleId: '',
        scaleMargins: { top: 0.9, bottom: 0 },
        color: '#26a69a'
      });

      const now = Math.floor(Date.now() / 1000);
      const data = [];
      for (let i = 0; i < 30; i++) {
        const t = now - (30 - i) * 86400;
        const o = 100 + Math.random() * 20;
        const c = o + (Math.random() - 0.5) * 10;
        const h = Math.max(o, c) + Math.random() * 5;
        const l = Math.min(o, c) - Math.random() * 5;
        const v = Math.floor(Math.random() * 10000);
        data.push({ time: t, open: o, high: h, low: l, close: c, volume: v });
      }

      const prices = data.map(d => ({
        time: d.time, open: d.open, high: d.high, low: d.low, close: d.close
      }));
      const volumes = data.map(d => ({
        time: d.time, value: d.volume, color: d.close > d.open ? '#26a69a' : '#ef5350'
      }));

      series.setData(prices);
      volumeSeries.setData(volumes);
    }

    document.getElementById('chartType').addEventListener('change', e => {
      drawChart(e.target.value);
    });

    document.getElementById('toggleTheme').addEventListener('click', () => {
      dark = !dark;
      drawChart(document.getElementById('chartType').value);
      document.getElementById('toggleTheme').innerText = dark ? 'Light Mode' : 'Dark Mode';
    });

    drawChart();
  </script>
</body>
</html>
